<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Spreadsheet Prefill</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
  <style>
    :root { --line:#e5e7eb; --muted:#6b7280; --brand:#2563eb; --bg:#fafafa; --card:#fff; --danger:#e11d48; }
    html,body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#111}
    .wrap{max-width:1000px;margin:0 auto;padding:12px}
    .toolbar,.footer{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,select,button{font:inherit}
    input[type="text"]{border:1px solid var(--line);border-radius:10px;padding:10px 12px;background:#fff;min-width:220px}
    select{border:1px solid var(--line);border-radius:10px;padding:10px;background:#fff}
    button{border:1px solid var(--line);border-radius:10px;padding:10px 12px;background:#fff;cursor:pointer}
    .primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .danger{color:var(--danger);border-color:#fecaca}
    .mini{color:var(--muted);font-size:12px}
    .list{margin-top:10px;border:1px solid var(--line);border-radius:12px;background:#fff;max-height:300px;overflow:auto}
    .row{padding:10px 12px;border-top:1px solid var(--line);display:flex;justify-content:space-between;gap:8px;cursor:pointer}
    .row:first-child{border-top:none}
    .pill{display:inline-block;background:#eef2ff;border:1px solid #c7d2fe;color:#1e3a8a;border-radius:999px;padding:3px 8px;font-size:12px}
    .card{margin-top:12px;border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px}
    .kv{display:grid;grid-template-columns:180px 1fr;gap:6px;align-items:center}
    .kv div{padding:3px 0}
    .msg{margin-top:8px;font-size:13px}
    .ok{color:#166534;background:#f0fdf4;border:1px solid #bbf7d0;padding:8px;border-radius:10px}
    .err{color:#991b1b;background:#fef2f2;border:1px solid #fecaca;padding:8px;border-radius:10px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    .section{border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px}
    .section h4{margin:0 0 8px 0;font-size:15px}
    .map-table{width:100%;border-collapse:collapse;margin-top:6px}
    .map-table th,.map-table td{border-top:1px solid var(--line);padding:6px}
    .map-table th{font-weight:600;text-align:left;color:#374151;background:#f9fafb}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe;border-radius:999px;font-size:12px}
    .inline{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .controls-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Data controls -->
    <div class="toolbar">
      <input id="csvUrl" type="text" placeholder="Live CSV URL (Google Sheets → Publish to CSV)" />
      <input id="keyInput" type="text" placeholder="Lookup key (e.g., email, code...)" />
      <button id="searchBtn" class="primary">Search</button>
      <button id="reloadBtn">Reload</button>
      <span class="mini">Tip: File → Share → Publish to web → CSV.</span>
    </div>

    <div class="toolbar" style="margin-top:6px">
      <label class="mini">Key Column</label>
      <select id="keyCol"></select>
      <label class="mini">Show Columns</label>
      <select id="showCols" multiple size="1" style="min-width:220px"></select>
    </div>

    <div id="list" class="list"></div>

    <!-- Details & mapping preview -->
    <div id="details" class="card" style="display:none"></div>

    <!-- Mapping UI -->
    <div class="section">
      <h4>Field Mapping</h4>
      <div class="mini">Map sheet columns to target names you’ll reference in Jotform Conditions (e.g., map “Email” → “Client Email”).</div>
      <div class="controls-row">
        <button id="addMap" class="primary">Add Mapping</button>
        <button id="autoMap">Auto-map</button>
        <button id="importMap">Import JSON</button>
        <button id="exportMap">Export JSON</button>
        <span id="mapStatus" class="mini"></span>
      </div>
      <table class="map-table" id="mapTable">
        <thead>
          <tr>
            <th style="width:28%">Source Column</th>
            <th style="width:28%">Target Name</th>
            <th style="width:18%">Transform</th>
            <th style="width:14%">Required</th>
            <th style="width:12%"></th>
          </tr>
        </thead>
        <tbody id="mapBody"></tbody>
      </table>
    </div>

    <div class="footer" style="justify-content:flex-end;margin-top:8px">
      <button id="useBtn" class="primary" disabled>Use This Row</button>
    </div>

    <div id="msg" class="msg"></div>
  </div>
  <script src="app.js"></script>
</body>
</html>
